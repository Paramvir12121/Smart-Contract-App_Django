<!DOCTYPE html>
<html>
  <head>
    <title>SMART CONTRACT TEST</title>
    <script
      type="text/javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/web3/1.2.7-rc.0/web3.min.js"
    ></script>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD"
      crossorigin="anonymous"
    />
    <style>
      body {
        background-color: rgba(225, 224, 224, 0.815);
        font-size: 20px;
        text-align: center;
      }
    </style>
  </head>
  <body>
    <div m-3>
      <button type="button" class="btn btn-primary" onclick="connectMetamask()">
        CONNECT TO METAMASK
      </button>
      <br />
      <p id="accountArea">Connection Status: NOT CONNECTED to Metamask</p>
    </div>
    <button type="button" class="btn btn-primary" onclick="connectContract()">
      CONNECT TO CONTRACT
    </button>
    <br />
    <p id="contractArea">Connection Status: NOT CONNECTED to Smart Contract</p>

    <button type="button" class="btn btn-primary" onclick="readWord()">
      GET DATA FROM CONTRACT
    </button>
    <br />
    <div class="container" style="width: 30rem">
      <div class="row">
        <div class="col">
          <p id="farmerNameArea"></p>
        </div>
        <div class="col">
          <p id="farmerIdArea"></p>
        </div>
      </div>
      <div class="row">
        <div class="col">
          <p id="lenderNameArea"></p>
        </div>
        <div class="col">
          <p id="lenderIdArea"></p>
        </div>
      </div>
      <div class="col-md m-3">
        <p id="amountArea"></p>
      </div>
    </div>
    <p id="dataArea" m-3>Data Status: NO Data from Smart Contract</p>

    <div m-3>
      <button type="button" class="btn btn-primary" onclick="changeWord()">
        CHANGE DATA ON THE SMART CONTRACT
      </button>
    </div>
    <br />
    <div m-3>
      <input type="text" id="inputArea" m-3 />
    </div>

    <script>
      let account;
      const connectMetamask = async () => {
        //let accountList = JSON.parse("{{ account_list_json|safe }}");
        //console.log(accountList);
        // let accountList = [
        //   {
        //     id: 1,
        //     fname: "Paramvir",
        //     lname: "Singh",
        //     email: "paramvir@singh.com",
        //     account_id: "0xD5E48834f756da33E0bAd46A981A2052BDd57fb3",
        //   },
        //   {
        //     id: 2,
        //     fname: "Paramvir",
        //     lname: "Singh",
        //     email: "paramvir@singh.com",
        //     account_id: "0xD5E48834f756da33E0bAd46A981A2052BDd57fb3",
        //   },
        //];
        //console.log(accountList[0]);
        // for (let x in accountList) {
        //   console.log("x is ", x, accountList[x]);
        // }
        if (window.ethereum !== "undefined") {
          const accounts = await ethereum.request({
            method: "eth_requestAccounts",
          });
          account = accounts[0];
          console.log("account value is: ", account);
          // if ("0xec95cad38df7b49b3432d83f0b80997e82a47a68" === account) {
          document.getElementById(
            "accountArea"
          ).innerHTML = `Account is: ${account}`;
          // }
        }
      };

      const connectContract = async () => {
        const ABI = [
          {
            inputs: [
              {
                internalType: "string",
                name: "_word",
                type: "string",
              },
            ],
            name: "changeAmount",
            outputs: [],
            stateMutability: "nonpayable",
            type: "function",
          },
          {
            inputs: [],
            name: "farmerId",
            outputs: [
              {
                internalType: "string",
                name: "",
                type: "string",
              },
            ],
            stateMutability: "view",
            type: "function",
          },
          {
            inputs: [],
            name: "farmerName",
            outputs: [
              {
                internalType: "string",
                name: "",
                type: "string",
              },
            ],
            stateMutability: "view",
            type: "function",
          },
          {
            inputs: [],
            name: "getAmount",
            outputs: [
              {
                internalType: "string",
                name: "",
                type: "string",
              },
            ],
            stateMutability: "view",
            type: "function",
          },
          {
            inputs: [],
            name: "lenderId",
            outputs: [
              {
                internalType: "string",
                name: "",
                type: "string",
              },
            ],
            stateMutability: "view",
            type: "function",
          },
          {
            inputs: [],
            name: "lenderName",
            outputs: [
              {
                internalType: "string",
                name: "",
                type: "string",
              },
            ],
            stateMutability: "view",
            type: "function",
          },
        ];
        const Address = "0x92AdEf588F76f7d484D2ff1fc35C6DeD23Ff5ebC";
        window.web3 = await new Web3(window.ethereum);
        window.contract = await new window.web3.eth.Contract(ABI, Address);
        document.getElementById("contractArea").innerHTML =
          "Connection Status: Success";
      };

      const readWord = async () => {
        const data = await window.contract.methods.getAmount().call();
        document.getElementById("dataArea").innerHTML = `Amount is: ${data}`;
        const farmerName = await window.contract.methods.farmerName().call();
        const farmerId = await window.contract.methods.farmerId().call();
        const lenderName = await window.contract.methods.lenderName().call();
        const lenderId = await window.contract.methods.lenderId().call();

        document.getElementById(
          "farmerNameArea"
        ).innerHTML = `Borrower Name: ${farmerName}`;
        document.getElementById("farmerIdArea").innerHTML = farmerId;
        document.getElementById(
          "lenderNameArea"
        ).innerHTML = `Lender Name: ${lenderName}`;
        document.getElementById("lenderIdArea").innerHTML = lenderId;
      };

      const changeWord = async () => {
        const myEntry = document.getElementById("inputArea").value;
        await window.contract.methods
          .changeAmount(myEntry)
          .send({ from: account });
      };
    </script>
  </body>
</html>
